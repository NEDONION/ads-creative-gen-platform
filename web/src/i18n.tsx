import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';

type Lang = 'zh' | 'en';

type Messages = Record<string, Record<Lang, string>>;

const messages: Messages = {
  appTitle: { zh: 'LLM å¹¿å‘Šåˆ›æ„å…¨é“¾è·¯ç”ŸæˆåŠå®éªŒå¹³å°', en: 'LLM Ads Creative & Experiment Platform' },
  navDashboard: { zh: 'ä»ªè¡¨ç›˜', en: 'Dashboard' },
  navCreative: { zh: 'åˆ›æ„ç”Ÿæˆ', en: 'Creative' },
  navAssets: { zh: 'ç´ æç®¡ç†', en: 'Assets' },
  navTasks: { zh: 'ä»»åŠ¡ç®¡ç†', en: 'Tasks' },
  navExperiments: { zh: 'å®éªŒåˆ—è¡¨', en: 'Experiments' },
  navExperimentNew: { zh: 'æ–°å»ºå®éªŒ', en: 'New Experiment' },
  navTraces: { zh: 'è°ƒç”¨é“¾è·¯', en: 'Traces' },
  headerDashboard: { zh: 'ä»ªè¡¨ç›˜', en: 'Dashboard' },
  headerCreative: { zh: 'åˆ›æ„ç”Ÿæˆ', en: 'Creative' },
  headerAssets: { zh: 'ç´ æç®¡ç†', en: 'Assets' },
  headerTasks: { zh: 'ä»»åŠ¡ç®¡ç†', en: 'Tasks' },
  headerExperiments: { zh: 'å®éªŒç®¡ç†', en: 'Experiments' },
  headerExperimentNew: { zh: 'æ–°å»ºå®éªŒ', en: 'Create Experiment' },
  headerTraces: { zh: 'è°ƒç”¨é“¾è·¯', en: 'Model Traces' },
  welcomeTitle: { zh: 'æ¬¢è¿ä½¿ç”¨', en: 'Welcome' },
  welcomeAction: { zh: 'ç«‹å³å¼€å§‹', en: 'Get Started' },
  aboutTitle: { zh: 'å…³äºå¹³å°', en: 'About the Platform' },
  recentActivity: { zh: 'æœ€è¿‘æ´»åŠ¨', en: 'Recent Activity' },
  viewAll: { zh: 'æŸ¥çœ‹å…¨éƒ¨', en: 'View all' },
  loading: { zh: 'åŠ è½½ä¸­...', en: 'Loading...' },
  retry: { zh: 'é‡è¯•', en: 'Retry' },
  currentConfig: { zh: 'å½“å‰é…ç½®', en: 'Current Config' },
  stepLabel: { zh: 'æ­¥éª¤', en: 'Step' },
  product: { zh: 'å•†å“', en: 'Product' },
  notFilled: { zh: 'æœªå¡«å†™', en: 'Not set' },
  outputLanguage: { zh: 'è¾“å‡ºè¯­è¨€', en: 'Output language' },
  auto: { zh: 'è‡ªåŠ¨', en: 'Auto' },
  cta: { zh: 'CTA', en: 'CTA' },
  sellingPoints: { zh: 'å–ç‚¹', en: 'Selling Points' },
  pendingGen: { zh: 'å¾…ç”Ÿæˆ', en: 'To be generated' },
  imageConfig: { zh: 'å›¾ç‰‡é…ç½®', en: 'Image Config' },
  count: { zh: 'æ•°é‡', en: 'Count' },
  style: { zh: 'é£æ ¼', en: 'Style' },
  size: { zh: 'å°ºå¯¸', en: 'Size' },
  progress: { zh: 'è¿›åº¦', en: 'Progress' },
  stepProduct: { zh: 'å•†å“', en: 'Product' },
  stepCopy: { zh: 'æ–‡æ¡ˆ', en: 'Selling Points' },
  stepCreative: { zh: 'ç”Ÿæˆ', en: 'Creative' },
  productName: { zh: 'å•†å“åç§°', en: 'Product name' },
  productPlaceholder: { zh: 'å¦‚ï¼šæ™ºèƒ½æ‰‹è¡¨ Pro', en: 'e.g. Smart Watch Pro' },
  outputLanguageLabel: { zh: 'è¾“å‡ºè¯­è¨€', en: 'Output language' },
  outputLangHint: { zh: 'é»˜è®¤è‡ªåŠ¨ï¼šæ ¹æ®å•†å“åç§°æ£€æµ‹ä¸­è‹±æ–‡ï¼Œå¯æ‰‹åŠ¨è¦†ç›–', en: 'Auto detect by product name, or override manually' },
  generateCopywriting: { zh: 'ç”Ÿæˆæ–‡æ¡ˆ', en: 'Generate copy' },
  generatingCopywriting: { zh: 'ç”Ÿæˆä¸­...', en: 'Generating...' },
  step1Title: { zh: 'æ­¥éª¤ 1ï¼šè¾“å…¥å•†å“', en: 'Step 1: Product input' },
  step1Hint: { zh: 'è¾“å…¥å•†å“åç§°ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ CTA å’Œå–ç‚¹', en: 'Enter product name to auto-generate CTA and selling points' },
  step2Title: { zh: 'æ­¥éª¤ 2ï¼šé€‰æ‹©/ç¼–è¾‘æ–‡æ¡ˆ', en: 'Step 2: Pick / edit copy' },
  step2Hint: { zh: 'é€‰æ‹©å–œæ¬¢çš„ CTA å’Œå–ç‚¹ï¼Œå¯æ‰‹åŠ¨å¾®è°ƒ', en: 'Pick CTA and selling points, optionally edit' },
  ctaSection: { zh: 'CTAï¼ˆè¡ŒåŠ¨å·å¬ï¼‰', en: 'CTA (call to action)' },
  editCTA: { zh: 'ç¼–è¾‘ CTAï¼ˆå¯é€‰ï¼‰', en: 'Edit CTA (optional)' },
  ctaPlaceholder: { zh: 'ä¸å¡«åˆ™ä½¿ç”¨é€‰æ‹©çš„ CTA', en: 'Leave empty to use selected CTA' },
  sellingSection: { zh: 'å–ç‚¹ï¼ˆè‡³å°‘é€‰ä¸€é¡¹ï¼‰', en: 'Selling points (pick at least one)' },
  editSP: { zh: 'ç¼–è¾‘å–ç‚¹ï¼ˆå¯é€‰ï¼Œä¸€è¡Œä¸€ä¸ªï¼‰', en: 'Edit selling points (optional, one per line)' },
  spPlaceholder: { zh: 'ä¸å¡«åˆ™ä½¿ç”¨å‹¾é€‰çš„å–ç‚¹', en: 'Leave empty to use selected points' },
  back: { zh: 'è¿”å›', en: 'Back' },
  confirmCopy: { zh: 'ç¡®è®¤æ–‡æ¡ˆ', en: 'Confirm copy' },
  submitting: { zh: 'æäº¤ä¸­...', en: 'Submitting...' },
  step3Title: { zh: 'æ­¥éª¤ 3ï¼šç”Ÿæˆåˆ›æ„', en: 'Step 3: Generate creatives' },
  step3Hint: { zh: 'è®¾ç½®é£æ ¼/å›¾ç‰‡ï¼Œæäº¤å³å¯ç”Ÿæˆ', en: 'Set style/images then submit' },
  creativeStyle: { zh: 'åˆ›æ„é£æ ¼', en: 'Style' },
  variantCount: { zh: 'å˜ä½“æ•°é‡', en: 'Variants' },
  productImageUrl: { zh: 'äº§å“å›¾ç‰‡URLï¼ˆå¯é€‰ï¼‰', en: 'Product image URL (optional)' },
  sizeLabel: { zh: 'å°ºå¯¸', en: 'Size' },
  sizePlaceholder: { zh: 'ä¾‹å¦‚: 1:1,9:16', en: 'e.g. 1:1,9:16' },
  variantConfigTitle: { zh: 'å˜ä½“é…ç½®ï¼ˆæ¯å¼ å›¾è‡ªå®šä¹‰é£æ ¼/æç¤ºè¯ï¼‰', en: 'Variant configs (style/prompt per image)' },
  variantTitle: { zh: 'å˜ä½“', en: 'Variant' },
  inheritGlobal: { zh: 'æ²¿ç”¨å…¨å±€é£æ ¼', en: 'Inherit global' },
  bright: { zh: 'æ˜äº®', en: 'Bright' },
  professional: { zh: 'ä¸“ä¸š', en: 'Professional' },
  modern: { zh: 'ç°ä»£', en: 'Modern' },
  elegant: { zh: 'ä¼˜é›…', en: 'Elegant' },
  vibrant: { zh: 'æ´»åŠ›', en: 'Vibrant' },
  customPrompt: { zh: 'è‡ªå®šä¹‰æç¤ºè¯', en: 'Custom prompt' },
  promptPlaceholder: { zh: 'å¯ä¸ºç©ºï¼Œç•™ç©ºåˆ™æŒ‰ CTA/å–ç‚¹è‡ªåŠ¨æ‹¼æç¤ºè¯', en: 'Optional; leave empty to auto-build prompt' },
  startGenerate: { zh: 'å¼€å§‹ç”Ÿæˆ', en: 'Start generation' },
  restart: { zh: 'é‡æ–°å¼€å§‹', en: 'Restart' },
  generalStyle: { zh: 'é€šç”¨é£æ ¼', en: 'General style' },
  styleBright: { zh: 'æ˜äº®é£æ ¼', en: 'Bright' },
  styleProfessional: { zh: 'ä¸“ä¸šé£æ ¼', en: 'Professional' },
  styleModern: { zh: 'ç°ä»£é£æ ¼', en: 'Modern' },
  styleElegant: { zh: 'ä¼˜é›…é£æ ¼', en: 'Elegant' },
  statAssets: { zh: 'æ€»ç´ ææ•°', en: 'Total assets' },
  statTasks: { zh: 'æ€»ä»»åŠ¡æ•°', en: 'Total tasks' },
  statExperiments: { zh: 'æ€»å®éªŒæ•°', en: 'Total experiments' },
  welcomeP1: { zh: 'å¼€å§‹åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªå¹¿å‘Šåˆ›æ„ï¼Œä½“éªŒ AI é©±åŠ¨çš„é«˜æ•ˆåˆ›ä½œæµç¨‹ã€‚', en: 'Create your first ad creative and experience an AI-driven workflow.' },
  welcomeP2: { zh: 'æ¨èæµç¨‹ï¼šä¸Šä¼ /å¡«å†™å•†å“ä¿¡æ¯ â†’ ç”Ÿæˆæ–‡æ¡ˆä¸å›¾ç‰‡ â†’ åœ¨å®éªŒä¸­é…ç½®å˜ä½“ â†’ è§‚å¯ŸæŒ‡æ ‡ä¸å¤ç›˜ã€‚', en: 'Suggested: input product â†’ generate copy & images â†’ set variants in experiments â†’ review metrics.' },
  welcomeHint: { zh: 'æ”¯æŒ CTA/å–ç‚¹è¦†ç›–ã€å•†å“åè¿‡æ»¤ã€ä»»åŠ¡è¯¦æƒ…æŸ¥çœ‹æç¤ºè¯/é£æ ¼ã€‚', en: 'Supports CTA/SP overrides, product filters, and viewing prompts/styles.' },
  aboutParagraph: { zh: 'AI é©±åŠ¨çš„å¹¿å‘Šåˆ›æ„ç”Ÿæˆå¹³å°ï¼Œæ•´åˆæ–‡æ¡ˆã€å›¾åƒç”Ÿæˆä¸å®éªŒæŠ•æ”¾ã€‚', en: 'AI-powered creative platform across copy, images, and experiments.' },
  feature1: { zh: 'åˆ›æ„ç”Ÿæˆï¼šå¤šæ ¼å¼/é£æ ¼è‡ªå®šä¹‰ï¼Œæç¤ºè¯æº¯æº', en: 'Creative gen: multi-format/style with prompt traceability' },
  feature2: { zh: 'ä»»åŠ¡ä¸ç´ æï¼šæŸ¥çœ‹å˜ä½“æç¤ºè¯/é£æ ¼ï¼Œåˆ†ç»„å±•ç¤º', en: 'Tasks & assets: view per-variant prompts/styles, grouped display' },
  feature3: { zh: 'å®éªŒï¼šåˆ—è¡¨/åˆ›å»ºåˆ†ç¦»ï¼ŒCTA/å–ç‚¹è¦†ç›–ï¼Œæ¿€æ´»/åœæ­¢ä¸æŒ‡æ ‡å¯¹æ¯”', en: 'Experiments: separate list/create, CTA/SP overrides, activate/stop with metrics' },
  feature4: { zh: 'è°ƒç”¨é“¾è·¯ï¼šè¿½è¸ª Tongyi å…³é”®æ­¥éª¤ï¼Œæ¥æºä¸ºå•†å“å', en: 'Traces: follow key Tongyi steps, source uses product name' },
  migrateTip: { zh: 'å¦‚æœ‰æ–°å¢å­—æ®µï¼Œè®¾ç½® AUTO_MIGRATE=true å¯è‡ªåŠ¨è¿ç§»ã€‚', en: 'Set AUTO_MIGRATE=true to auto-migrate when new fields are added.' },
  activityError: { zh: 'åŠ è½½æœ€è¿‘æ´»åŠ¨å¤±è´¥', en: 'Failed to load recent activity' },
  noActivity: { zh: 'æš‚æ— æ´»åŠ¨', en: 'No activity yet' },
  noActivityHint: { zh: 'å®Œæˆä»»åŠ¡æˆ–ç”Ÿæˆç´ æåå°†åœ¨è¿™é‡Œæ˜¾ç¤º', en: 'Complete tasks or generate assets to see them here.' },
  activityMore: { zh: 'ä»…æ˜¾ç¤ºæœ€è¿‘ 5 æ¡ï¼Œæ›´å¤šè¯·å‰å¾€ä»»åŠ¡/ç´ æ/å®éªŒåˆ—è¡¨æŸ¥çœ‹ã€‚', en: 'Showing latest 5. See tasks/assets/experiments for more.' },
  refresh: { zh: 'åˆ·æ–°', en: 'Refresh' },
  refreshing: { zh: 'åˆ·æ–°ä¸­...', en: 'Refreshing...' },
  loadingMore: { zh: 'åŠ è½½ä¸­...', en: 'Loading...' },
  emptyAssets: { zh: 'æš‚æ— ç´ æ', en: 'No assets yet' },
  emptyAssetsHint: { zh: 'ç”Ÿæˆåˆ›æ„åç´ æå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ', en: 'Generate creatives to see assets here.' },
  groupByProduct: { zh: 'æŒ‰å•†å“/åˆ›æ„åˆ†ç»„', en: 'Grouped by product/creative' },
  groupByHint: { zh: 'ç‚¹å‡»å¡ç‰‡å¯æŸ¥çœ‹è¯¥å•†å“çš„æ‰€æœ‰ç´ æ', en: 'Click to view all assets of the product' },
  sellingPointsLabel: { zh: 'å–ç‚¹', en: 'Selling points' },
  titleLabel: { zh: 'æ ‡é¢˜', en: 'Title' },
  pageInfo: { zh: 'ç¬¬ {current} / {total} é¡µ', en: 'Page {current} / {total}' },
  totalAssetsText: { zh: 'å…± {n} ä¸ªç´ æ', en: '{n} assets' },
  totalTasksText: { zh: 'å…± {n} ä¸ªä»»åŠ¡', en: '{n} tasks' },
  emptyTasks: { zh: 'æš‚æ— ä»»åŠ¡', en: 'No tasks yet' },
  emptyTasksHint: { zh: 'åˆ›å»ºåˆ›æ„ç”Ÿæˆä»»åŠ¡åå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ', en: 'Create a creative task to see it here.' },
  taskId: { zh: 'ä»»åŠ¡ID', en: 'Task ID' },
  titleProduct: { zh: 'æ ‡é¢˜/å•†å“', en: 'Title/Product' },
  copywriting: { zh: 'åˆ›æ„æ–‡æ¡ˆ', en: 'Ad Text' },
  status: { zh: 'çŠ¶æ€', en: 'Status' },
  progressLabel: { zh: 'è¿›åº¦', en: 'Progress' },
  createdAt: { zh: 'åˆ›å»ºæ—¶é—´', en: 'Created at' },
  completedAt: { zh: 'å®Œæˆæ—¶é—´', en: 'Completed at' },
  actions: { zh: 'æ“ä½œ', en: 'Actions' },
  details: { zh: 'è¯¦æƒ…', en: 'Details' },
  delete: { zh: 'åˆ é™¤', en: 'Delete' },
  deleteConfirm: { zh: 'ç¡®å®šåˆ é™¤è¯¥ä»»åŠ¡åŠå…¶ç´ æå—ï¼Ÿ', en: 'Delete this task and assets?' },
  deleteFailed: { zh: 'åˆ é™¤å¤±è´¥', en: 'Delete failed' },
  backToList: { zh: 'è¿”å›åˆ—è¡¨', en: 'Back to list' },
  refreshDetail: { zh: 'åˆ·æ–°è¯¦æƒ…', en: 'Refresh detail' },
  taskDetail: { zh: 'ä»»åŠ¡è¯¦æƒ…', en: 'Task Detail' },
  taskTitle: { zh: 'æ ‡é¢˜', en: 'Title' },
  productNameLabel: { zh: 'å•†å“åç§°', en: 'Product' },
  variantConfig: { zh: 'å˜ä½“é…ç½®', en: 'Variant Configs' },
  promptLabel: { zh: 'æç¤ºè¯', en: 'Prompt' },
  assetGenerated: { zh: 'ç”Ÿæˆç´ æ', en: 'Generated assets' },
  promptSet: { zh: 'æç¤ºè¯å·²è®¾ç½®', en: 'Prompt set' },
  styleLabelShort: { zh: 'é£æ ¼', en: 'Style' },
  experimentList: { zh: 'å®éªŒåˆ—è¡¨', en: 'Experiment List' },
  experimentListHint: { zh: 'è½»é‡é¢æ¿ï¼šæŸ¥çœ‹ / æ¿€æ´» / åœæ­¢ / æŒ‡æ ‡', en: 'Quick panel: view / activate / stop / metrics' },
  createExperiment: { zh: 'æ–°å»ºå®éªŒ', en: 'Create Experiment' },
  createExperimentHint: { zh: 'é…ç½®å˜ä½“å’Œæƒé‡ï¼Œåˆ›å»ºåå¯åœ¨å®éªŒåˆ—è¡¨æŸ¥çœ‹', en: 'Configure variants/weights; view in list after creating' },
  nameLabel: { zh: 'å®éªŒåç§°', en: 'Experiment Name' },
  productLabel: { zh: 'å•†å“å', en: 'Product' },
  noProduct: { zh: 'æš‚æ— å•†å“ï¼Œè¯·å…ˆåˆ›å»ºä»»åŠ¡', en: 'No products yet, create a task first' },
  variantConfigLabel: { zh: 'å˜ä½“é…ç½®', en: 'Variant Configs' },
  selectCreative: { zh: 'è¯·é€‰æ‹©åˆ›æ„', en: 'Select creative' },
  creativeId: { zh: 'åˆ›æ„ID', en: 'Creative ID' },
  weight: { zh: 'æƒé‡', en: 'Weight' },
  ctaOverride: { zh: 'CTAï¼ˆé€‰æ‹©æˆ–è¦†ç›–ï¼‰', en: 'CTA (select or override)' },
  useDefault: { zh: 'ä½¿ç”¨åˆ›æ„é»˜è®¤', en: 'Use creative default' },
  creativeCTA: { zh: 'åˆ›æ„ï¼š', en: 'Creative: ' },
  currentOverride: { zh: 'å½“å‰è¦†ç›–ï¼š', en: 'Current override: ' },
  spOverride: { zh: 'å–ç‚¹ï¼ˆé€‰æ‹©æˆ–è¦†ç›–ï¼‰', en: 'Selling Points (select or override)' },
  addVariantBtn: { zh: 'æ–°å¢å˜ä½“', en: 'Add Variant' },
  remove: { zh: 'ç§»é™¤', en: 'Remove' },
  submitCreate: { zh: 'åˆ›å»ºå®éªŒ', en: 'Create Experiment' },
  loadingShort: { zh: 'åŠ è½½ä¸­...', en: 'Loading...' },
  noExperiment: { zh: 'æš‚æ— å®éªŒï¼Œå…ˆåˆ›å»ºä¸€ä¸ªå§', en: 'No experiments yet, please create one.' },
  name: { zh: 'åç§°', en: 'Name' },
  statusLabel: { zh: 'çŠ¶æ€', en: 'Status' },
  createdAtShort: { zh: 'åˆ›å»ºæ—¶é—´', en: 'Created' },
  experimentId: { zh: 'å®éªŒID', en: 'Experiment ID' },
  actionsShort: { zh: 'æ“ä½œ', en: 'Actions' },
  view: { zh: 'æŸ¥çœ‹', en: 'View' },
  collapse: { zh: 'æ”¶èµ·', en: 'Collapse' },
  detailTitle: { zh: 'å®éªŒè¯¦æƒ…', en: 'Experiment Detail' },
  detailHint: { zh: 'æ—¶é•¿ / å®šä¹‰ / å˜ä½“ç´ æ', en: 'Duration / Definition / Variants' },
  activate: { zh: 'æ¿€æ´»', en: 'Activate' },
  activated: { zh: 'å·²æ¿€æ´»', en: 'Activated' },
  stop: { zh: 'åœæ­¢', en: 'Stop' },
  stopped: { zh: 'å·²åœæ­¢', en: 'Stopped' },
  refreshMetrics: { zh: 'åˆ·æ–°æŒ‡æ ‡', en: 'Refresh metrics' },
  duration: { zh: 'æ—¶é•¿', en: 'Duration' },
  startAt: { zh: 'å¼€å§‹', en: 'Start' },
  endAt: { zh: 'ç»“æŸ', en: 'End' },
  variantDef: { zh: 'å˜ä½“å®šä¹‰', en: 'Variant Definition' },
  metricsTitle: { zh: 'å½“å‰æŒ‡æ ‡', en: 'Current Metrics' },
  noMetrics: { zh: 'å½“å‰å®éªŒæš‚æ— æŒ‡æ ‡æ•°æ®ï¼Œå¯èƒ½å°šæœªäº§ç”Ÿæ›å…‰/ç‚¹å‡»ã€‚', en: 'No metrics yet; impressions/clicks may not exist.' },
  noDataNotice: { zh: 'å½“å‰å®éªŒæš‚æ— æœ‰æ•ˆæ›å…‰/ç‚¹å‡»æ•°æ®ï¼Œå¯èƒ½æ˜¯åˆšåˆ›å»ºæˆ–æœªæŠ•æ”¾ã€‚ç¨ååˆ·æ–°å³å¯æŸ¥çœ‹ã€‚', en: 'No valid impressions/clicks yet; newly created or not delivered. Refresh later.' },
  totalImpressions: { zh: 'æ€»æ›å…‰', en: 'Total Impr.' },
  totalClicks: { zh: 'æ€»ç‚¹å‡»', en: 'Total Clicks' },
  avgCtr: { zh: 'å¹³å‡CTR', en: 'Avg CTR' },
  bestCtr: { zh: 'æœ€ä½³CTR', en: 'Best CTR' },
  aboveAvg: { zh: 'é«˜äºå‡å€¼', en: 'Above avg' },
  belowAvg: { zh: 'ä½äºå‡å€¼', en: 'Below avg' },
  traceId: { zh: 'Trace ID', en: 'Trace ID' },
  filterStatus: { zh: 'çŠ¶æ€ç­›é€‰', en: 'Status filter' },
  filter: { zh: 'ç­›é€‰', en: 'Filter' },
  source: { zh: 'æ¥æº', en: 'Source' },
  result: { zh: 'ç»“æœ', en: 'Result' },
  runTime: { zh: 'è€—æ—¶', en: 'Duration' },
  startTime: { zh: 'å¼€å§‹æ—¶é—´', en: 'Start Time' },
  endTime: { zh: 'ç»“æŸæ—¶é—´', en: 'End Time' },
  noTraces: { zh: 'æš‚æ— é“¾è·¯', en: 'No traces' },
  steps: { zh: 'æ­¥éª¤', en: 'Steps' },
  createFail: { zh: 'åˆ›å»ºå¤±è´¥', en: 'Create failed' },
  createSuccess: { zh: 'åˆ›å»ºæˆåŠŸ', en: 'Created successfully' },
  fillName: { zh: 'è¯·å¡«å†™å®éªŒåç§°', en: 'Please fill experiment name' },
  fillVariant: { zh: 'è¯·å¡«å†™æœ‰æ•ˆçš„åˆ›æ„IDå’Œæƒé‡', en: 'Please provide valid creative and weight' },
  copySuccess: { zh: 'å·²å¤åˆ¶', en: 'Copied' },
  copyFail: { zh: 'å¤åˆ¶å¤±è´¥', en: 'Copy failed' },
  noThumb: { zh: 'æ— ç¼©ç•¥å›¾', en: 'No thumbnail' },
  admin: { zh: 'ç®¡ç†å‘˜', en: 'Admin' },
  basicInfo: { zh: 'æ­¥éª¤ 1ï¼šåŸºç¡€ä¿¡æ¯', en: 'Step 1: Basic Info' },
  basicInfoHint: { zh: 'å¡«å†™å®éªŒåç§°ä¸å•†å“åç§°ï¼Œåç»­å¯åœ¨å˜ä½“ä¸­æŒ‡å®šåˆ›æ„', en: 'Set experiment/product; choose creatives in variants' },
  variantStep: { zh: 'æ­¥éª¤ 2ï¼šé…ç½®å˜ä½“', en: 'Step 2: Configure variants' },
  variantStepHint: { zh: 'ä¸ºæ¯ä¸ªå˜ä½“é€‰æ‹©åˆ›æ„ã€æƒé‡ï¼Œä»¥åŠè¦†ç›– CTA/å–ç‚¹', en: 'Pick creative, weight, and CTA/SP overrides per variant' },
  summaryHint: { zh: 'å³ä¾§å®æ—¶æ±‡æ€»å½“å‰é…ç½®ï¼Œä¾¿äºæ£€æŸ¥', en: 'Right panel summarizes current selections' },
  variantLabel: { zh: 'å˜ä½“', en: 'Variant' },
  copyId: { zh: 'å¤åˆ¶', en: 'Copy' },
  traceListTitle: { zh: 'è°ƒç”¨åˆ—è¡¨', en: 'Trace List' },
  traceListHint: { zh: 'trace æ¦‚è§ˆ', en: 'Trace overview' },
  query: { zh: 'æŸ¥è¯¢', en: 'Query' },
  all: { zh: 'å…¨éƒ¨', en: 'All' },
  model: { zh: 'æ¨¡å‹', en: 'Model' },
  ops: { zh: 'æ“ä½œ', en: 'Actions' },
  noData: { zh: 'æš‚æ— æ•°æ®', en: 'No data' },
  input: { zh: 'è¾“å…¥', en: 'Input' },
  output: { zh: 'è¾“å‡º', en: 'Output' },
  error: { zh: 'é”™è¯¯', en: 'Error' },
  noSteps: { zh: 'æš‚æ— æ­¥éª¤æ•°æ®', en: 'No step data' },
  start: { zh: 'å¼€å§‹', en: 'Start' },
  end: { zh: 'ç»“æŸ', en: 'End' },
  resourcesTitle: { zh: 'A/B å®éªŒæ’ä»¶çº¿ä¸Šä½¿ç”¨', en: 'A/B Experiment Serving Plugin Live Usage' },
  previewPlugin: { zh: 'A/B å®éªŒæ’ä»¶é¢„è§ˆ', en: 'A/B Experiment Serving Plugin Preview' },
  personalWebsite: { zh: 'ä¸ªäººç½‘ç«™', en: 'Personal Site' },
  githubRepo: { zh: 'GitHub ä»“åº“', en: 'GitHub Repo' },

  // Plugin Preview Page
  widgetConfig: { zh: 'âš™ï¸ æ’ä»¶é…ç½®', en: 'âš™ï¸ Widget Configuration' },
  widgetConfigHint: { zh: 'é…ç½®å®éªŒå‚æ•°ï¼Œé¢„è§ˆæ’ä»¶æ•ˆæœ', en: 'Configure experiment parameters and preview widget' },
  widgetScriptUrl: { zh: 'Widget Script URL', en: 'Widget Script URL' },
  widgetScriptHint: { zh: 'Vercel æ¯æ¬¡éƒ¨ç½²ä¼šç”Ÿæˆæ–°çš„æ–‡ä»¶åã€‚æœ¬åœ°æµ‹è¯•å¯ä½¿ç”¨:', en: 'Vercel generates new filename on each deployment. Use for local testing:' },
  apiBaseUrl: { zh: 'API Base URL', en: 'API Base URL' },
  quickSwitch: { zh: 'å¿«é€Ÿåˆ‡æ¢ï¼š', en: 'Quick switch:' },
  localDev: { zh: 'æœ¬åœ°å¼€å‘', en: 'Local Dev' },
  production: { zh: 'çº¿ä¸Šç¯å¢ƒ', en: 'Production' },
  selectActiveExperiment: { zh: 'é€‰æ‹©å·²æ¿€æ´»çš„å®éªŒ', en: 'Select Active Experiment' },
  noActiveExperiments: { zh: 'æ— å·²æ¿€æ´»çš„å®éªŒ', en: 'No active experiments' },
  pleaseSelectExperiment: { zh: 'è¯·é€‰æ‹©å®éªŒ', en: 'Please select' },
  noActiveExperimentsHint: { zh: 'æ²¡æœ‰å·²æ¿€æ´»çš„å®éªŒï¼Œè¯·å…ˆåœ¨', en: 'No active experiments, please activate one in' },
  activateExperimentHint: { zh: 'ä¸­æ¿€æ´»ä¸€ä¸ªå®éªŒ', en: 'first' },
  selected: { zh: 'å·²é€‰æ‹©:', en: 'Selected:' },
  userKeyOptional: { zh: 'User Keyï¼ˆå¯é€‰ï¼‰', en: 'User Key (Optional)' },
  userKeyHint: { zh: 'ç”¨äºæ ‡è¯†ç”¨æˆ·ï¼Œä¸å¡«åˆ™ä½¿ç”¨åŒ¿å ID', en: 'Used to identify users, anonymous ID will be used if not provided' },
  enableRandomAssignment: { zh: 'å¯ç”¨éšæœºåˆ†é…', en: 'Enable Random Assignment' },
  randomAssignmentHint: { zh: 'å¼€å¯åæ¯æ¬¡åˆ·æ–°éƒ½ä¼šé‡æ–°åˆ†é…å˜ä½“ï¼ˆç”¨äºæµ‹è¯•ï¼‰', en: 'Reassign variant on each refresh (for testing)' },
  loadPreview: { zh: 'åŠ è½½é¢„è§ˆ', en: 'Load Preview' },
  livePreview: { zh: 'ğŸ¨ å®æ—¶é¢„è§ˆ', en: 'ğŸ¨ Live Preview' },
  previewLoaded: { zh: 'âœ… é¢„è§ˆå·²åŠ è½½ï¼ŒæŸ¥çœ‹ä¸‹æ–¹æ•ˆæœ', en: 'âœ… Preview loaded, check below' },
  clickToLoadPreview: { zh: 'ç‚¹å‡»"åŠ è½½é¢„è§ˆ"æŒ‰é’®å¼€å§‹', en: 'Click "Load Preview" to start' },
  ready: { zh: 'å‡†å¤‡å°±ç»ª', en: 'Ready' },
  configureAndLoad: { zh: 'é…ç½®å¥½å‚æ•°åï¼Œç‚¹å‡»"åŠ è½½é¢„è§ˆ"æŒ‰é’®', en: 'Configure parameters and click "Load Preview"' },
  viewWidgetEffect: { zh: 'æŸ¥çœ‹å®éªŒæ’ä»¶çš„çœŸå®æ•ˆæœ', en: 'View the actual widget effect' },
  integrationCode: { zh: 'ğŸ“¦ é›†æˆä»£ç ', en: 'ğŸ“¦ Integration Code' },
  integrationCodeHint: { zh: 'å¤åˆ¶ä»¥ä¸‹ä»£ç åˆ°æ‚¨çš„ç½‘ç«™å³å¯ä½¿ç”¨', en: 'Copy the code below to your website' },
  copyIntegrationCode: { zh: 'å¤åˆ¶é›†æˆä»£ç ', en: 'Copy Integration Code' },
  integrationTips: { zh: 'ğŸ’¡ é›†æˆæç¤º', en: 'ğŸ’¡ Integration Tips' },
  integrationTip1: { zh: 'å°†ä¸Šè¿°ä»£ç æ”¾åœ¨ HTML çš„ <body> æ ‡ç­¾å†…å³å¯', en: 'Place the code inside HTML <body> tag' },
  integrationTip2: { zh: 'æ’ä»¶ä¼šè‡ªåŠ¨åˆ›å»º #exp-widget-root å…ƒç´ å¹¶æ¸²æŸ“å†…å®¹', en: 'Widget will auto-create #exp-widget-root element and render content' },
  integrationTip3: { zh: 'ä½¿ç”¨ Shadow DOM éš”ç¦»æ ·å¼ï¼Œä¸ä¼šå½±å“æ‚¨çš„ç½‘ç«™', en: 'Uses Shadow DOM for style isolation, won\'t affect your site' },
  integrationTip4: { zh: 'è‡ªåŠ¨è¿½è¸ªæ›å…‰å’Œç‚¹å‡»ï¼Œæ— éœ€é¢å¤–é…ç½®', en: 'Auto-tracks impressions and clicks, no extra config needed' },
  loadFailed: { zh: 'åŠ è½½å¤±è´¥:', en: 'Load failed:' },
  checkApiBaseUrl: { zh: 'è¯·æ£€æŸ¥ API Base URL æ˜¯å¦æ­£ç¡®ï¼Œæˆ–è€…åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œä¸­', en: 'Please check if API Base URL is correct or if backend is running' },
  loadedFrom: { zh: 'å·²ä»', en: 'Loaded from' },
  loaded: { zh: 'åŠ è½½', en: 'loaded' },
  activeExperimentsCount: { zh: 'ä¸ªæ¿€æ´»çš„å®éªŒ', en: 'active experiments' },
  pleaseSelectExperimentFirst: { zh: 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå®éªŒï¼', en: 'Please select an experiment first!' },
  integrationCodeCopied: { zh: 'âœ… é›†æˆä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', en: 'âœ… Integration code copied to clipboard!' },
  experimentConfig: { zh: 'ğŸ“‹ å®éªŒé…ç½®', en: 'ğŸ“‹ Experiment Configuration' },
  widgetPreviewArea: { zh: 'ğŸ¨ æ’ä»¶é¢„è§ˆåŒºåŸŸï¼ˆWidget å°†è‡ªåŠ¨æ¸²æŸ“åœ¨å³ä¾§ï¼‰', en: 'ğŸ¨ Widget Preview Area (Widget will auto-render on the right)' },
};

interface I18nValue {
  lang: Lang;
  t: (key: keyof typeof messages, fallback?: string) => string;
  toggle: () => void;
  setLang: (lang: Lang) => void;
}

const I18nContext = createContext<I18nValue | null>(null);

export const I18nProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [lang, setLangState] = useState<Lang>('zh');

  useEffect(() => {
    const stored = localStorage.getItem('lang');
    if (stored === 'en' || stored === 'zh') {
      setLangState(stored);
    }
  }, []);

  const setLang = (next: Lang) => {
    setLangState(next);
    localStorage.setItem('lang', next);
  };

  const value = useMemo<I18nValue>(
    () => ({
      lang,
      setLang,
      toggle: () => setLang(lang === 'zh' ? 'en' : 'zh'),
      t: (key, fallback) => (messages[key]?.[lang] || fallback || messages[key]?.zh || key),
    }),
    [lang]
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export const useI18n = () => {
  const ctx = useContext(I18nContext);
  if (!ctx) {
    throw new Error('useI18n must be used within I18nProvider');
  }
  return ctx;
};
