<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿å‘Šç´ æç®¡ç†å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .subtitle {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-top: 24px;
        }

        button:hover {
            background: #2980b9;
        }

        .btn-refresh {
            background: #27ae60;
        }

        .btn-refresh:hover {
            background: #229954;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex: 1;
            min-width: 200px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .asset-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s;
        }

        .asset-card:hover {
            transform: translateY(-5px);
        }

        .asset-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .asset-info {
            padding: 15px;
        }

        .asset-id {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 8px;
            word-break: break-all;
        }

        .asset-format {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }

        .asset-dimensions {
            font-size: 0.9rem;
            color: #2c3e50;
        }

        .asset-url {
            margin-top: 10px;
            font-size: 0.8rem;
            color: #7f8c8d;
            word-break: break-all;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .page-btn {
            padding: 8px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .page-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .current-page {
            padding: 0 10px;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #7f8c8d;
        }

        .error {
            background: #fadbd8;
            color: #c0392b;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .form-group {
                min-width: 100%;
            }
            
            .assets-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¨ å¹¿å‘Šç´ æç®¡ç†å¹³å°</h1>
            <div class="subtitle">æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰ç”Ÿæˆçš„å¹¿å‘Šç´ æ</div>
        </header>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalAssets">0</div>
                <div class="stat-label">æ€»ç´ ææ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="todayAssets">0</div>
                <div class="stat-label">ä»Šæ—¥æ–°å¢</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalTasks">0</div>
                <div class="stat-label">ä»»åŠ¡æ•°</div>
            </div>
        </div>

        <div class="controls">
            <div class="form-row">
                <div class="form-group">
                    <label for="formatFilter">æ ¼å¼ç­›é€‰:</label>
                    <select id="formatFilter">
                        <option value="">å…¨éƒ¨æ ¼å¼</option>
                        <option value="1:1">1:1 (æ­£æ–¹å½¢)</option>
                        <option value="16:9">16:9 (æ¨ªå±)</option>
                        <option value="9:16">9:16 (ç«–å±)</option>
                        <option value="4:3">4:3 (æ ‡å‡†)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskFilter">ä»»åŠ¡IDç­›é€‰:</label>
                    <input type="text" id="taskFilter" placeholder="è¾“å…¥ä»»åŠ¡ID">
                </div>
                <div class="form-group">
                    <label for="pageSize">æ¯é¡µæ•°é‡:</label>
                    <select id="pageSize">
                        <option value="12">12</option>
                        <option value="24" selected>24</option>
                        <option value="48">48</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <button onclick="loadAssets()">æœç´¢</button>
                <button class="btn-refresh" onclick="refreshAssets()">åˆ·æ–°</button>
                <button onclick="clearFilters()">æ¸…ç©ºç­›é€‰</button>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">åŠ è½½ä¸­...</div>
        <div id="error" class="error" style="display: none;"></div>

        <div id="assetsContainer" class="assets-grid">
            <!-- ç´ æå¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <div class="pagination" id="pagination">
            <!-- åˆ†é¡µæ§ä»¶å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentPage = 1;
        let totalPages = 1;
        let totalAssets = 0;

        // é¡µé¢åŠ è½½æ—¶è·å–ç´ æ
        document.addEventListener('DOMContentLoaded', function() {
            loadAssets();
            loadStats();
        });

        // åŠ è½½ç´ æåˆ—è¡¨
        async function loadAssets() {
            showLoading(true);
            hideError();
            
            try {
                const format = document.getElementById('formatFilter').value;
                const taskID = document.getElementById('taskFilter').value;
                const pageSize = document.getElementById('pageSize').value;
                
                let url = `http://localhost:4000/api/v1/creative/assets?page=${currentPage}&page_size=${pageSize}`;
                if (format) url += `&format=${encodeURIComponent(format)}`;
                if (taskID) url += `&task_id=${encodeURIComponent(taskID)}`;
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.code !== 0) {
                    throw new Error(result.message || 'è·å–ç´ æå¤±è´¥');
                }
                
                displayAssets(result.data.assets);
                updatePagination(result.data.total, result.data.page, result.data.page_size, result.data.total_pages);
                
            } catch (error) {
                showError(`åŠ è½½ç´ æå¤±è´¥: ${error.message}`);
                console.error('Error loading assets:', error);
            } finally {
                showLoading(false);
            }
        }

        // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
        async function loadStats() {
            try {
                const response = await fetch('http://localhost:4000/api/v1/creative/assets?page=1&page_size=1', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.code === 0) {
                    document.getElementById('totalAssets').textContent = result.data.total || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('totalAssets').textContent = 'åŠ è½½å¤±è´¥';
            }
        }

        // æ˜¾ç¤ºç´ æ
        function displayAssets(assets) {
            const container = document.getElementById('assetsContainer');
            
            if (!assets || assets.length === 0) {
                container.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7f8c8d;">æ²¡æœ‰æ‰¾åˆ°ç´ æ</div>';
                return;
            }
            
            const html = assets.map(asset => `
                <div class="asset-card">
                    <img src="${asset.image_url}" alt="å¹¿å‘Šç´ æ" class="asset-image" 
                         onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"250\" height=\"200\" viewBox=\"0 0 250 200\"><rect width=\"250\" height=\"200\" fill=\"%23f0f0f0\"/><text x=\"125\" y=\"100\" font-family=\"Arial\" font-size=\"12\" text-anchor=\"middle\" fill=\"%23999\">å›¾ç‰‡åŠ è½½å¤±è´¥</text></svg>'; this.alt='å›¾ç‰‡åŠ è½½å¤±è´¥'">
                    <div class="asset-info">
                        <div class="asset-id">${asset.id.substring(0, 8)}...</div>
                        <div class="asset-format">${asset.format}</div>
                        <div class="asset-dimensions">${asset.width} x ${asset.height}</div>
                        <div class="asset-url" title="${asset.image_url}">${truncateUrl(asset.image_url)}</div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // æˆªæ–­URLæ˜¾ç¤º
        function truncateUrl(url) {
            if (url.length > 30) {
                return url.substring(0, 15) + '...' + url.substring(url.length - 15);
            }
            return url;
        }

        // æ›´æ–°åˆ†é¡µ
        function updatePagination(total, currentPageNum, pageSize, totalPagesNum) {
            totalAssets = total;
            currentPage = currentPageNum;
            totalPages = totalPagesNum;
            
            const pagination = document.getElementById('pagination');
            
            let html = '';
            
            // ä¸Šä¸€é¡µæŒ‰é’®
            html += `<button class="page-btn" ${currentPage <= 1 ? 'disabled' : ''} onclick="goToPage(${currentPage - 1})">ä¸Šä¸€é¡µ</button>`;
            
            // é¡µç æŒ‰é’®
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            if (startPage > 1) {
                html += `<button class="page-btn" onclick="goToPage(1)">1</button>`;
                if (startPage > 2) html += `<span>...</span>`;
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="page-btn" ${i === currentPage ? 'style="background: #2c3e50;"' : ''} onclick="goToPage(${i})">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span>...</span>`;
                html += `<button class="page-btn" onclick="goToPage(${totalPages})">${totalPages}</button>`;
            }
            
            // ä¸‹ä¸€é¡µæŒ‰é’®
            html += `<button class="page-btn" ${currentPage >= totalPages ? 'disabled' : ''} onclick="goToPage(${currentPage + 1})">ä¸‹ä¸€é¡µ</button>`;
            
            // é¡µç ä¿¡æ¯
            html += `<div class="current-page">ç¬¬ ${currentPage} é¡µï¼Œå…± ${totalPages} é¡µ (${totalAssets} é¡¹)</div>`;
            
            pagination.innerHTML = html;
        }

        // è·³è½¬åˆ°æŒ‡å®šé¡µ
        function goToPage(page) {
            if (page < 1 || page > totalPages || page === currentPage) return;
            currentPage = page;
            loadAssets();
        }

        // åˆ·æ–°ç´ æ
        function refreshAssets() {
            loadAssets();
            loadStats();
        }

        // æ¸…ç©ºç­›é€‰æ¡ä»¶
        function clearFilters() {
            document.getElementById('formatFilter').value = '';
            document.getElementById('taskFilter').value = '';
            document.getElementById('pageSize').value = '24';
            currentPage = 1;
            loadAssets();
        }

        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // éšè—é”™è¯¯ä¿¡æ¯
        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        // æŒ‰å›è½¦é”®æœç´¢
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadAssets();
            }
        });
    </script>
</body>
</html>